# Database Files

There are a number of files that can be utilised to populate the attestation database

   * hashes.json
   * policies.json

and an ingest program that requires a10rest to be running

## JSON Format
The contents of the files is JSON and in the form of a list of JSON objects, for example:

```json
[
{
    "description": "Returns the TCG x86 default CRTM PCRs",
    "intent": "tpm2/quote",
    "name": "CRTM x86",
    "parameters": {
        "hashalg": "sha256",
        "pcrselection": "sha256:0"
    },
    "type": "tpm2/quote"
},
{
    "description": "Returns the TCG x86 default SRTM PCRs",
    "intent": "tpm2/quote",
    "name": "SRTM x86",
    "parameters": {
        "hashalg": "sha256",
        "pcrselection": "sha256:0,1,2,3,4,5,6,7"
    },
    "type": "tpm2/quote"
}
]
```


## Database Ingest By Script
To input the contents into the database run the following commands

```bash
python3 adbingest.py hashes hashes.json http://127.0.0.1:8520
python3 adbingest.py policies policies.json http://127.0.0.1:8520
python3 adbingest.py pcrschemas pcrschemas.json http://127.0.0.1:8520

```

   * The first parameter is the type. Only two types are accepted: hashes and policies. No type checking is made of the contents being ingested, though the attestation engine may complain about missing fields.
   * The second parameter is the name of the JSON file to be input.
   * The third parameter is the location of the A10Rest endpoint.

The script will output to stdout a JSON object containing list of itemid's generated by the attestation engine along with the location in the list of any items that have failed.

Successfully adding of these documents to the database will cause A10 to report this in its log files.

For example:

```bash
$ python3 adbingest.py  policies policies.json http://127.0.0.1:8520
Reading policies.json into policies
13 items to import
Progress : 7.6923076923076925 %
Progress : 15.384615384615385 %
Progress : 23.076923076923077 %
Progress : 30.76923076923077 %
Progress : 38.46153846153847 %
Progress : 46.15384615384615 %
Progress : 53.84615384615385 %
Progress : 61.53846153846154 %
Progress : 69.23076923076923 %
Progress : 76.92307692307693 %
Progress : 84.61538461538461 %
Progress : 92.3076923076923 %
Progress : 100.0 %
Ingest complete
[   {'httpcode': 200, 'n': 0},
    {'httpcode': 200, 'n': 1},
    {'httpcode': 200, 'n': 2},
    {'httpcode': 200, 'n': 3},
    {'httpcode': 200, 'n': 4},
    {'httpcode': 200, 'n': 5},
    {'httpcode': 200, 'n': 6},
    {'httpcode': 200, 'n': 7},
    {'httpcode': 200, 'n': 8},
    {'httpcode': 200, 'n': 9},
    {'httpcode': 200, 'n': 10},
    {'httpcode': 200, 'n': 11},
    {'httpcode': 200, 'n': 12}]
```

## Database Ingest By Other Means

Because the files are supplied as JSON document they can be imported using a tool suchas mongo-express. This tool runs as part of the docker-compose deployment of a10.

